language: cpp

compiler:
  - clang
#  - gcc

os:
  - linux
  - osx

env:
  - BUILD_TYPE=RelWithDebInfo
  - BUILD_TYPE=Release
  - BUILD_TYPE=Debug

cache: apt

before_install:
  - git clone https://github.com/berkus/travis-scripts.git travis-ci
  - git clone https://github.com/berkus/cmake-setup.git cmake
  - git clone https://github.com/berkus/endian.git endian
  - ./travis-ci/travis_install_packages.sh
  - ./travis-ci/travis_build_ninja.sh
  - ./travis-ci/travis_build_libcxx.sh
  - ./travis-ci/travis_build_boost.sh
  - sudo pip install cpp-coveralls
script:
  - cmake -G "Ninja" -DTRAVIS_CI=YES -DCMAKE_BUILD_TYPE=$BUILD_TYPE -DTEST_COVERAGE=YES -DBUILD_TESTING=YES . && ninja && ASAN_OPTIONS=alloc_dealloc_mismatch=0 ctest
after_success:
  - coveralls --build-root `pwd` --exclude boost_1_55_0 --exclude boost --exclude CMakeFiles --exclude 3rdparty --exclude ninja --exclude libcxx

notifications:
  recipients:
    - berkus@atta-metta.net
  email:
    on_success: change
    on_failure: always
